# GitLab to VK

Позволяет отправлять уведомления из GitLab в VK. 

Все данные хранятся на серверах VK в [Storage](https://vk.com/dev/storage). Ключи имеют префикс `gitlabvk_`.

## Установка

Вы можете скачать готовые исполняемые файлы [на странице релизов](https://github.com/SevereCloud/vksdk/releases) 

### Docker

```bash
docker run -d -p 8080:8080 \
-e GITLABVK_DOMAIN=example.com \
-e GITLABVK_ACCESS_TOKEN=vkgrouptoken1234 \
severecloud/gitlabvk
```

### Docker-compose

```yaml
services:
  gitlabvk:
    image: severecloud/gitlabvk
    environment:
      GITLABVK_DOMAIN: example.com
      GITLABVK_ACCESS_TOKEN: vkgrouptoken1234
    ports:
      - "8080:8080"
```

### Из исходного кода

```bash
git clone git@github.com:SevereCloud/gitlabvk.git
cd gitlabvk
go build -o gitlabvk ./cmd/bot
```

Docker контейнер:

```bash
docker build -t severecloud/gitlabvk .
```

## Конфигурация

Сконфигурировать бота можно через файл или переменные окружения.

Чтобы бот использовал конфигурационный файл, используйте флаг `-config=myconfig.toml` (по умолчанию `config.toml`). Поддерживает JSON, TOML, YAML, HCL, envfile и Java properties файлы.

Пример toml конфигурации:

```toml
domain = "example.com" # домен на который будут приходить события
access_token = "token" # ключ сообщества с правами на сообщения

# Необязательные поля
addr = ":8080" # адрес на котором будет запущен сервер. По умолчанию ":8080"
```

Переменные окружения имеют префикс `GITLABVK_`

- `GITLABVK_DOMAIN`
- `GITLABVK_ACCESS_TOKEN`
- `GITLABVK_ADDR`

### `domain`

Домен на который будут приходить события от VK и GitLab

### `access_token`

Ключ доступа сообщества. Перед тем как получить ключ, необходимо включить сообщения сообщества:

1. Зайти в **Управление сообществом**  
2. Нажать сбоку на вкладку **Сообщения**
3. Включите сообщения сообщества
4. Нажать на синюю кнопу **Сохранить** 
5. Нажать сбоку на вкладку **Настройки для бота**
6. Включите возможности ботов
7. Если требуется, разрешите добавлять сообщество в беседы
8. Нажать на синюю кнопку **Сохранить** 

Чтобы получить ключ доступа, необходимо:

1. Зайти в **Управление сообществом** 
2. Нажать сбоку на вкладку **Работа с API** (Настройки)
3. Нажать на синюю кнопу **Создать ключ** 
4. Выбрать право **Разрешить приложению доступ к сообщениям сообщества** и **Разрешить приложению доступ к сообщениям сообщества**
5. Нажать кнопку **Создать**
6. Подтвердить действие
7. Скопируйте ключ в конфигурацию

### `addr`

Адрес на котором будет запущен HTTP сервер. По умолчанию `:8080`
